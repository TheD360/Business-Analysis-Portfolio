-- This is the suggested order to create the database, in order not to have the program return errors due to referential integrity.
-- MODEL - 1st
-- AIRCRAFT -2nd
-- PILOT - 3rd
-- CREW - 4th 
-- CHARTER - 5th


-- IN THIS PROJECT I HAD TO DESIGN A DATABASE FROM SCRATCH LINKING VARIOUS TABLES WITHIN THE DATABASE AS I CREATED IT.
-- THIS HAD TO BE DONE FIRST BEFORE I WOULD BE ABLE TO PERFORM THE COMPLEX QUERIES REQUESTED BY THE ADVANCED SQL QUERY QUESTIONS FROM 
-- DATABASE SYSTEMS DESIGN, IMPLEMENTATION & MANAGEMENT 13th EDITION, CHAPTER 8 UNDER 'REVIEW QUESTIONS AND PROBLEM SET'
CREATE TABLE CHARTER (
CHAR_TRIP INT PRIMARY KEY,
CHAR_DATE DATE,
AC_NUMBER VARCHAR(10),
CHAR_DESTINATION VARCHAR(10),
CHAR_DISTANCE VARCHAR(4),
CHAR_HOURS_FLOWN DECIMAL(10,2),
CHAR_HOURS_WAIT DECIMAL(10,2),
CHAR_FUEL_GALLONS DECIMAL(10,2),
CHAR_OIL_WTS CHAR(1),
CUS_CODE CHAR(5),
);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10001, '2018-02-05', '2289L', 'ATL', 936, 5.1, 2.2, 354.1, 1, 10011);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10002, '2018-02-05', '2778V', 'BNA', 320, 1.6, 0, 7.6, 0, 10016);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10003, '2018-02-05', '4278Y', 'GNV', 1574, 7.8, 0, 339.8, 2, 10014);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10004, '2018-02-06', '1484P', 'STL', 472, 2.9, 4.9, 97.2, 1, 10019);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10005, '2018-02-06', '2289L', 'ATL', 1023, 5.7, 3.5, 397.7, 2, 10011);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10006, '2018-02-06', '4278Y', 'STL', 472, 2.6, 5.2, 117.1, 0, 10017);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10007, '2018-02-06', '2778V', 'GNV', 1574, 7.9, 0, 348.4, 2, 10012);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10008, '2018-02-07', '1484P', 'TYS', 644, 4.1, 0, 140.6, 1, 10014);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10009, '2018-02-07', '2289L', 'GNV', 1574, 6.6, 23.4, 459.9, 0, 10017);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10010, '2018-02-07', '4278Y', 'ATL', 998, 6.2, 3.2, 279.7, 0, 10016);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10011, '2018-02-07', '1484P', 'BNA', 352, 1.9, 5.3, 66.4, 1, 10012);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10012, '2018-02-08', '2778V', 'MOB', 884, 4.8, 4.2, 215.1, 0, 10010);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10013, '2018-02-08', '4278Y', 'TYS', 644, 3.9, 4.5, 174.3, 1, 10011);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10014, '2018-02-09', '4278Y', 'ATL', 936, 6.1, 2.1, 302.6, 0, 10017);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10015, '2018-02-09', '2289L', 'GNV', 1645, 6.7, 0, 459.5, 2, 10016);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10016, '2018-02-09', '2778V', 'MQY', 312, 1.5, 0, 67.2, 0, 10011);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (10017, '2018-02-10', '1484P', 'STL', 508, 3.1, 0, 105.5, 0, 10014);

INSERT INTO CHARTER (CHAR_TRIP, CHAR_DATE, AC_NUMBER, CHAR_DESTINATION, CHAR_DISTANCE, CHAR_HOURS_FLOWN, CHAR_HOURS_WAIT, CHAR_FUEL_GALLONS, CHAR_OIL_WTS, CUS_CODE)
VALUES (100018, '2018-02-10', '4278Y', 'TYS', 644, 3.8, 4.5, 167.4, 0, 10017);


CREATE TABLE PILOT (
EMP_NUM INT PRIMARY KEY,
PIL_LICENSE CHAR(3),
PIL_RATINGS VARCHAR(50),
PIL_MED_TYPE CHAR(1),
PIL_MED_DATE DATE,
PIL_PT135_DATE DATE,
);

INSERT INTO PILOT (EMP_NUM, PIL_LICENSE, PIL_RATINGS, PIL_MED_TYPE, PIL_MED_DATE, PIL_PT135_DATE)
VALUES (101, 'ATP', 'ATP/SEL/MEL/Instr/CFII', 1, '2018-01-20', '2018-01-20');

INSERT INTO PILOT (EMP_NUM, PIL_LICENSE, PIL_RATINGS, PIL_MED_TYPE, PIL_MED_DATE, PIL_PT135_DATE)
VALUES (104, 'ATP', 'ATP/SEL/MEL/Instr', 1, '2018-01-20', '2018-01-20');

INSERT INTO PILOT (EMP_NUM, PIL_LICENSE, PIL_RATINGS, PIL_MED_TYPE, PIL_MED_DATE, PIL_PT135_DATE)
VALUES (105, 'COM', 'COMM/SEL/MEL/Instr/CFI', 1, '2018-01-20', '2018-01-20');

INSERT INTO PILOT (EMP_NUM, PIL_LICENSE, PIL_RATINGS, PIL_MED_TYPE, PIL_MED_DATE, PIL_PT135_DATE)
VALUES (106, 'COM', 'COMM/SEL/MEL/Instr', 1, '2018-01-20', '2018-01-20');

INSERT INTO PILOT (EMP_NUM, PIL_LICENSE, PIL_RATINGS, PIL_MED_TYPE, PIL_MED_DATE, PIL_PT135_DATE)
VALUES (109, 'COM', 'ATP/SEL/MEL/SES/Instr/CFII', 1, '2018-01-20', '2018-01-20');

CREATE TABLE MODEL (
MOD_CODE VARCHAR(30) PRIMARY KEY,
MOD_MANUFACTURER VARCHAR(30),
MOD_NAME VARCHAR(30),
MOD_SEATS VARCHAR(2),
MOD_CHG_MILE DECIMAL (10,2),
);

INSERT INTO MODEL (MOD_CODE, MOD_MANUFACTURER, MOD_NAME, MOD_SEATS, MOD_CHG_MILE)
VALUES ('C-90A', 'Beechcraft', 'KingAir', 8, 2.67);

INSERT INTO MODEL (MOD_CODE, MOD_MANUFACTURER, MOD_NAME, MOD_SEATS, MOD_CHG_MILE)
VALUES ('PA23-250', 'Piper', 'Aztec', 6, 1.93);

INSERT INTO MODEL (MOD_CODE, MOD_MANUFACTURER, MOD_NAME, MOD_SEATS, MOD_CHG_MILE)
VALUES ('PA31-350', 'Piper', 'Navajo Chieftain', 10, 2.35);


CREATE TABLE CREW (
CHAR_TRIP CHAR(5),
EMP_NUM CHAR(3),
CREW_JOB VARCHAR(10)
);

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10001, 104, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10002, 101, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10003, 105, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10003, 109, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10004, 106, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10005, 101, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10006, 109, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10007, 104, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10007, 105, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10008, 106, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10009, 105, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10010, 108, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10011, 101, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10011, 104, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10012, 101, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10013, 105, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10014, 106, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10015, 101, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10015, 104, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10016, 105, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10016, 109, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10017, 101, 'pilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10018, 104, 'Copilot');

INSERT INTO CREW (CHAR_TRIP, EMP_NUM, CREW_JOB)
VALUES (10018, 105, 'pilot');


CREATE TABLE AIRCRAFT (
AC_NUMBER CHAR(5) PRIMARY KEY,
MOD_CODE VARCHAR(10),
AC_TTAF DECIMAL(10,2),
AC_TTEL DECIMAL(10,2),
AC_TTER DECIMAL(10,2),
);

INSERT INTO AIRCRAFT (AC_NUMBER, MOD_CODE, AC_TTAF, AC_TTEL, AC_TTER)
VALUES ('1484P', 'PA23-250', 1833.1, 1833.1, 101.8);

INSERT INTO AIRCRAFT (AC_NUMBER, MOD_CODE, AC_TTAF, AC_TTEL, AC_TTER)
VALUES ('2289L', 'C-90A', 4243.8, 768.9, 1123.4);

INSERT INTO AIRCRAFT (AC_NUMBER, MOD_CODE, AC_TTAF, AC_TTEL, AC_TTER)
VALUES ('2778V', 'PA31-350', 7992.9, 1513.1, 789.5);

INSERT INTO AIRCRAFT (AC_NUMBER, MOD_CODE, AC_TTAF, AC_TTEL, AC_TTER)
VALUES ('4278Y', 'PA31-350', 2147.3, 622.1, 243.2);



--

-- Q35 & Q36
-- This code adds a new attribute to the MODEL table
ALTER TABLE MODEL
ADD MOD_WAIT_CHG NUMERIC;

-- This code updates the new attribute [MOD_WAIT_CHG] created with the vaules that should be in each record.
UPDATE MODEL
SET MOD_WAIT_CHG = 100
WHERE MOD_CODE = 'C-90A';

UPDATE MODEL
SET MOD_WAIT_CHG = 50
WHERE MOD_CODE = 'PA23-250';

UPDATE MODEL
SET MOD_WAIT_CHG = 75
WHERE MOD_CODE = 'PA31-350';


SELECT * FROM MODEL;


-- Q37
ALTER TABLE CHARTER
ADD CHAR_WAIT_CHG NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_FLT_CHG_HR NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_FLT_CHG NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_TAX_CHG NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_TOT_CHG NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_PYMT NUMERIC;

ALTER TABLE CHARTER
ADD CHAR_BALANCE NUMERIC;



-- Q38
UPDATE CHARTER
SET CHAR_WAIT_CHG = (SELECT MOD_WAIT_CHG FROM MODEL M JOIN AIRCRAFT A ON M.MOD_CODE = A.MOD_CODE
JOIN CHARTER C ON A.AC_NUMER = C.AC_NUMBER);


-- Q39
UPDATE CHARTER
SET CHAR_FLT_CHG_HR = (SELECT MOD_CHG_MILE FROM MODEL M JOIN AIRCRAFT A ON M.MOD_CODE = A.MOD_CODE
JOIN CHARTER C ON A.AC_NUMER = C.AC_NUMBER);


-- Q 40
UPDATE CHARTER
SET CHAR_FLT_CHG = CHAR_HOURS_FLOWN * CHAR_FLT_CHG_HR


-- Q 41
UPDATE CHARTER 
SET CHAR_TAX_CHG = CHAR_FLT_CHG * (8/100);


-- Q 42
UPDATE CHARTER
SET CHAR_TOT_CHG = CHAR_FLT_CHG + CHAR_TAX_CHG


-- Q 43
-- This code adds a new attribute/column to the PILOT table
ALTER TABLE PILOT
ADD PIL_PIC_HRS NUMERIC;


-- PART 2:

--Creating the delete procedure
CREATE PROCEDURE PRC_INV_DELETE
@INV_NUMBER INT

AS
DELETE FROM INVOICE
WHERE INV_NUMBER = @INV_NUMBER;


-- Testing the procedure that was created
EXECUTE PRC_INV_DELETE 8005;

EXECUTE PRC_INV_DELETE 8006;

